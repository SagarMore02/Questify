<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <title>Create Exam</title>
    <link rel="stylesheet" href="/css/ExamCreation.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div class="container">
        <div class="title">Create Exam</div>
        <div class="content">
            <form id="exam-form">
                <div class="user-details">
                    <div class="input-box">
                        <span class="details">Exam Title</span>
                        <input type="text" id="name" name="name" maxlength="50" placeholder="Enter Exam Name" required>
                    </div>
                    <div class="input-box">
                        <span class="details">Application Start Date</span>
                        <input type="date" id="app_start_date" name="app_start_date" required>
                    </div>
                    <div class="input-box">
                        <span class="details">Application End Date</span>
                        <input type="date" id="app_end_date" name="app_end_date" required>
                    </div>
                    <div class="input-box">
                        <span class="details">Exam Start Date</span>
                        <input type="date" id="exam_start_date" name="exam_start_date" required>
                    </div>
                    <div class="input-box">
                        <span class="details">Exam End Date</span>
                        <input type="date" id="exam_end_date" name="exam_end_date" required>
                    </div>
                    <div class="input-box">
                        <span class="details">Exam Start Time</span>
                        <input type="time" id="exam_start_time" name="exam_start_time" required>
                    </div>
                    <div class="input-box">
                        <span class="details">Exam End Time</span>
                        <input type="time" id="exam_end_time" name="exam_end_time" required>
                    </div>
                    <div class="input-box">
                        <span class="details">Total Marks</span>
                        <input type="number" id="total_marks" name="total_marks" placeholder="Enter Total Marks" required>
                    </div>
                    <div class="input-box">
                        <span class="details">Passing Marks</span>
                        <input type="number" id="passing_marks" name="passing_marks" placeholder="Enter Passing Marks" required>
                    </div>
                    <div class="input-box">
                        <span class="details">Fees</span>
                        <input type="number" id="fees" name="fees" placeholder="Enter Fees" required>
                    </div>
                    <div class="input-box">
                        <span class="details">Syllabus</span>
                        <input type="text" id="syllabus" name="syllabus" maxlength="100" placeholder="Enter Syllabus" required>
                    </div>
                </div>
                <input id="submit" type="submit" value="Create Exam">
            </form>
        </div>
    </div>

    <script>
        document.getElementById('exam-form').addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevent the form from submitting the traditional way

            // Gather form data
            const formData = new FormData(this);

            const examTitle = formData.get('name');
            const appStartDate = formData.get('app_start_date');
            const appEndDate = formData.get('app_end_date');
            const examStartDate = formData.get('exam_start_date');
            const examEndDate = formData.get('exam_end_date');
            const examStartTime = formData.get('exam_start_time');
            const examEndTime = formData.get('exam_end_time');
            const totalMarks = formData.get('total_marks');
            const passingMarks = formData.get('passing_marks');
            const fees = formData.get('fees');
            const syllabus = formData.get('syllabus');

            // Validate form inputs
            if (parseInt(passingMarks) > parseInt(totalMarks)) {
                alert('Passing Marks cannot be greater than Total Marks');
                document.getElementById('passing_marks').value = '';
                return;
            }
            if (examStartDate > examEndDate) {
                alert('Exam Start Date cannot be later than Exam End Date');
                document.getElementById('exam_end_date').value = '';
                return;
            }
            if (examStartTime > examEndTime) {
                alert('Exam Start Time cannot be later than Exam End Time');
                document.getElementById('exam_end_time').value = '';
                return;
            }
            if (appStartDate > appEndDate) {
                alert('Application Start Date cannot be later than Application End Date');
                document.getElementById('app_end_date').value = '';
                return;
            }
            if (appStartDate > examStartDate) {
                alert('Application Start Date cannot be later than Exam Start Date');
                document.getElementById('app_start_date').value = '';
                return;
            }

            const myformData = {
                examTitle: examTitle,
                appStartDate: appStartDate,
                appEndDate: appEndDate,
                examStartDate: examStartDate,
                examEndDate: examEndDate,
                examStartTime: examStartTime,
                examEndTime: examEndTime,
                totalMarks: totalMarks,
                passingMarks: passingMarks,
                fees: fees,
                syllabus: syllabus
            };

            try {
                const response = await fetch('/addExam', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(myformData)
                });

                const data = await response.json();

                if (response.ok) {
                    alert('Exam created successfully!');
                    // Optionally redirect or clear the form as needed
                    // window.location.href = data.redirectURL; // Uncomment if redirection is needed
                } else {
                    alert('Error creating exam: ' + data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error submitting the form.');
            }

            // Reset form after submission
            this.reset();
        });
    </script>
</body>
</html>
